<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scrimy z Firebase</title>
  <style>
    /* Minimalne style dla czytelności */
    body { font-family: Poppins, sans-serif; padding: 20px; background: #121212; color: #eee; }
    input, select, button { padding: 8px; margin: 5px 0; width: 100%; max-width: 300px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #444; padding: 8px; text-align: center; }
    .win { color: #4CAF50; }
    .lose { color: #f44336; }
    .champion-icon { width: 24px; height: 24px; margin: 0 2px; vertical-align: middle; }
    .champion-icons-container { display: flex; justify-content: center; }
    button.delete-btn { background: #f44336; border: none; color: white; cursor: pointer; padding: 5px 10px; }
  </style>
</head>
<body>

<h1>Historia Scrimów z Firebase</h1>

<section>
  <h2>Dodaj nowy Scrim</h2>
  <form id="scrimForm">
    <label>Data:<br />
      <input type="date" id="scrimDate" required />
    </label><br />

    <label>Wynik:<br />
      <select id="scrimResult" required>
        <option value="">Wybierz wynik</option>
        <option value="WIN">WIN</option>
        <option value="LOSE">LOSE</option>
      </select>
    </label><br />

    <label>Czas gry:<br />
      <input type="text" id="scrimTime" placeholder="np. 35:12" required />
    </label><br />

    <label>Nasze Postacie (Top, Jungle, Mid, Adc, Support):</label><br />
    <input type="text" class="our-champion-input" placeholder="Top" required />
    <input type="text" class="our-champion-input" placeholder="Jungle" required />
    <input type="text" class="our-champion-input" placeholder="Mid" required />
    <input type="text" class="our-champion-input" placeholder="Adc" required />
    <input type="text" class="our-champion-input" placeholder="Support" required /><br />

    <label>Postacie Przeciwników (Top, Jungle, Mid, Adc, Support):</label><br />
    <input type="text" class="enemy-champion-input" placeholder="Top" required />
    <input type="text" class="enemy-champion-input" placeholder="Jungle" required />
    <input type="text" class="enemy-champion-input" placeholder="Mid" required />
    <input type="text" class="enemy-champion-input" placeholder="Adc" required />
    <input type="text" class="enemy-champion-input" placeholder="Support" required /><br />

    <button type="submit">Dodaj Scrim</button>
  </form>
</section>

<section>
  <h2>Scrimy</h2>
  <table>
    <thead>
      <tr>
        <th>Data</th>
        <th>Wynik</th>
        <th>Czas gry</th>
        <th>Nasze Postacie</th>
        <th>Postacie Przeciwników</th>
        <th>Akcje</th>
      </tr>
    </thead>
    <tbody id="scrimTableBody"></tbody>
  </table>
</section>

<section>
  <h2>Statystyki</h2>
  <div>Ilość scrimów: <span id="totalScrims">0</span></div>
  <div>Wygrane: <span id="wins">0</span></div>
  <div>Przegrane: <span id="losses">0</span></div>
  <div>% zwycięstw: <span id="winRate">0%</span></div>
</section>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Firebase config (twoje dane)
  const firebaseConfig = {
    apiKey: "AIzaSyA4depHuFw3bJ3Uq2gjKeiW5umhjiKnJ40",
    authDomain: "acg-skrimy.firebaseapp.com",
    databaseURL: "https://acg-skrimy-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "acg-skrimy",
    storageBucket: "acg-skrimy.appspot.com",
    messagingSenderId: "78237268518",
    appId: "1:78237268518:web:6b02118d081b4a49b384e7",
    measurementId: "G-6VDFPFX560"
  };

  // Inicjalizacja Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // DOM references
  const scrimForm = document.getElementById('scrimForm');
  const scrimTableBody = document.getElementById('scrimTableBody');
  const totalScrimsSpan = document.getElementById('totalScrims');
  const winsSpan = document.getElementById('wins');
  const lossesSpan = document.getElementById('losses');
  const winRateSpan = document.getElementById('winRate');

  // Funkcja pobierająca ikonkę championa (prosta)
  function getChampionIconUrl(championName) {
    if (!championName) return 'https://via.placeholder.com/24?text=?';
    // Prosta transformacja na nazwę DataDragon
    const cleanName = championName.trim().replace(/\s+/g, '').replace(/'/g, '');
    const ddName = cleanName.charAt(0).toUpperCase() + cleanName.slice(1);
    return `https://ddragon.leagueoflegends.com/cdn/14.22.1/img/champion/${ddName}.png`;
  }

  // Renderowanie tabeli z scrimami
  function renderScrims(scrims) {
    scrimTableBody.innerHTML = '';

    scrims.forEach(({ id, date, result, time, our, enemy }) => {
      const row = document.createElement('tr');

      // Tworzenie ikon championów
      const createChampIcons = (str) => {
        return str.split(',').map(name => {
          name = name.trim();
          if (!name) return '';
          const url = getChampionIconUrl(name);
          return `<img src="${url}" alt="${name}" title="${name}" class="champion-icon" onerror="this.src='https://via.placeholder.com/24?text=?'"/>`;
        }).join('');
      };

      row.innerHTML = `
        <td>${date}</td>
        <td class="${result.toLowerCase()}">${result}</td>
        <td>${time}</td>
        <td><div class="champion-icons-container">${createChampIcons(our)}</div></td>
        <td><div class="champion-icons-container">${createChampIcons(enemy)}</div></td>
        <td><button class="delete-btn" data-id="${id}">Usuń</button></td>
      `;

      scrimTableBody.appendChild(row);
    });

    // Dodaj event listener do przycisków usuwania
    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.onclick = () => {
        const id = btn.getAttribute('data-id');
        if (confirm('Na pewno usunąć ten scrim?')) {
          db.ref('scrims/' + id).remove();
        }
      };
    });

    updateStats(scrims);
  }

  // Aktualizacja statystyk
  function updateStats(scrims) {
    const total = scrims.length;
    const wins = scrims.filter(s => s.result === 'WIN').length;
    const losses = scrims.filter(s => s.result === 'LOSE').length;
    const winRate = total ? ((wins / total) * 100).toFixed(2) : 0;

    totalScrimsSpan.textContent = total;
    winsSpan.textContent = wins;
    lossesSpan.textContent = losses;
    winRateSpan.textContent = winRate + '%';
  }

  // Nasłuchiwanie zmian w bazie i renderowanie danych
  db.ref('scrims').on('value', (snapshot) => {
    const data = snapshot.val() || {};
    // Zamiana obiektu na tablicę z id
    const scrims = Object.keys(data).map(key => ({
      id: key,
      ...data[key]
    })).sort((a, b) => b.date.localeCompare(a.date)); // sortuj malejąco po dacie

    renderScrims(scrims);
  });

  // Obsługa formularza - dodawanie nowego scrimu do bazy
  scrimForm.addEventListener('submit', (e) => {
    e.preventDefault();

    const date = document.getElementById('scrimDate').value;
    const result = document.getElementById('scrimResult').value;
    const time = document.getElementById('scrimTime').value;

    const ourChampions = Array.from(document.querySelectorAll('.our-champion-input'))
      .map(i => i.value.trim())
      .filter(Boolean)
      .join(', ');

    const enemyChampions = Array.from(document.querySelectorAll('.enemy-champion-input'))
      .map(i => i.value.trim())
      .filter(Boolean)
      .join(', ');

    if (!date || !result || !time || !ourChampions || !enemyChampions) {
      alert('Uzupełnij wszystkie pola!');
      return;
    }

    // Tworzymy nowy scrim w bazie - klucz generowany przez push()
    db.ref('scrims').push({
      date,
      result,
      time,
      our: ourChampions,
      enemy: enemyChampions
    });

    scrimForm.reset();
  });
</script>

</body>
</html>
